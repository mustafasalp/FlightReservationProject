<div class="booking-page-bg"></div>

<div class="booking-container">

  <!-- ALWAYS VISIBLE DEBUG INFO -->
  <div *ngIf="loading" class="loading-state"
    style="background: #fff; padding: 20px; border-radius: 12px; text-align: center;">
    <p>Loading flight details...</p>
  </div>

  <div *ngIf="errorMessage && !loading" class="error-msg"
    style="background: #fee2e2; padding: 20px; border-radius: 12px; color: #dc2626; text-align: center;">
    {{ errorMessage }}
  </div>

  <div class="booking-card" *ngIf="flight && !loading">
    <h2>Complete Your Booking</h2>

    <!-- FLIGHT SUMMARY -->
    <div class="flight-summary">
      <div class="airline-row">
        <span class="airline-name">{{ flight.airline }}</span>
        <span class="flight-num">{{ flight.flightNumber }}</span>
      </div>
      <div class="route-row">
        <div class="city">
          <span class="code">{{ getAirportCode(flight.origin) }}</span>
          <span class="name">{{ flight.origin }}</span>
          <span class="time">{{ flight.departureTime | date:'shortTime' }}</span>
        </div>
        <div class="connector">
          âœˆ
          <span class="duration">{{ flight.duration }}</span>
        </div>
        <div class="city text-right">
          <span class="code">{{ getAirportCode(flight.destination) }}</span>
          <span class="name">{{ flight.destination }}</span>
          <span class="time">{{ flight.arrivalTime | date:'shortTime' }}</span>
        </div>
      </div>
    </div>

    <!-- BOOKING FORM -->
    <form [formGroup]="bookingForm" (ngSubmit)="submitBooking()">

      <!-- VISUAL SEAT MAP -->
      <div class="seat-map-container"
        style="background: transparent; padding: 0; margin-bottom: 2rem; display: flex; justify-content: center;">

        <div class="plane-fuselage"
          style="background: white; border: none; border-radius: 200px 200px 50px 50px; padding: 0; position: relative; width: 100%; max-width: 500px; box-shadow: 0 40px 100px rgba(0,0,0,0.2); overflow: hidden;">

          <!-- NOSE CONE & COCKPIT -->
          <div class="fuselage-header"
            style="background: linear-gradient(to bottom, #f8fafc, #eff6ff); padding-top: 60px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0; position: relative;">

            <!-- Cockpit Windows -->
            <div class="cockpit-windows" style="display: flex; justify-content: center; gap: 4px; margin-bottom: 20px;">
              <div
                style="width: 30px; height: 35px; background: #334155; clip-path: polygon(20% 0, 100% 10%, 100% 100%, 0% 100%);">
              </div>
              <div
                style="width: 40px; height: 35px; background: #334155; clip-path: polygon(0 10%, 100% 10%, 100% 100%, 0% 100%);">
              </div>
              <div
                style="width: 30px; height: 35px; background: #334155; clip-path: polygon(0 10%, 80% 0, 100% 100%, 0% 100%);">
              </div>
            </div>
          </div>

          <!-- FRONT SERVICE AREA (Blue Zone) -->
          <div class="service-area-front"
            style="background: #0ea5e9; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; color: white; position: relative;">
            <div style="font-size: 1.5rem;">ðŸš½</div>
            <div style="font-weight: bold; letter-spacing: 2px;">FRONT</div>
            <div style="font-size: 1.5rem;">â˜•</div>

            <!-- Door Indicators -->
            <div
              style="position: absolute; left: -5px; top: 10px; bottom: 10px; width: 10px; background: #fca5a5; border-radius: 5px;">
            </div>
            <div
              style="position: absolute; right: -5px; top: 10px; bottom: 10px; width: 10px; background: #fca5a5; border-radius: 5px;">
            </div>
          </div>

          <!-- SEATING AREA -->
          <div class="plane-body"
            style="padding: 40px 30px; background: white; min-height: 400px; position: relative; z-index: 2;">

            <!-- Headers -->
            <div class="seat-row-header"
              style="display: grid; grid-template-columns: 45px 1fr 1fr 1fr 30px 1fr 1fr 1fr 45px; gap: 8px; text-align: center; font-weight: bold; color: #94a3b8; margin-bottom: 15px; align-items: end;">
              <div style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Window</div>
              <div>A</div>
              <div>B</div>
              <div>C</div>
              <div></div>
              <div>D</div>
              <div>E</div>
              <div>F</div>
              <div style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Window</div>
            </div>

            <!-- Rows -->
            <div *ngFor="let row of rows" class="seat-row"
              style="display: grid; grid-template-columns: 45px 1fr 1fr 1fr 30px 1fr 1fr 1fr 45px; gap: 8px; align-items: center; margin-bottom: 8px;">

              <!-- Left Window -->
              <div
                style="width: 8px; height: 28px; background: #e0f2fe; border: 2px solid #cbd5e1; border-radius: 10px; margin: 0 auto;">
              </div>

              <!-- LEFT SEATS -->
              <ng-container *ngFor="let col of ['A','B','C']">
                <div style="display: flex; justify-content: center;">
                  <ng-container *ngIf="getSeat(row, col) as seat; else noSeat">
                    <div class="seat" [class.reserved]="seat.isReserved" [class.selected]="isSelected(seat.id)"
                      (click)="selectSeat(seat)"
                      style="width: 44px; height: 44px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.2s; border-bottom: 4px solid rgba(0,0,0,0.1); position: relative;"
                      [ngStyle]="{
                                        'background': seat.isReserved ? '#ef4444' : (isSelected(seat.id) ? '#22c55e' : (seat.class === 'Business' ? '#eab308' : '#fff')),
                                        'border': seat.isReserved ? 'none' : (isSelected(seat.id) ? 'none' : '2px solid #94a3b8'),
                                        'color': seat.isReserved ? 'white' : (isSelected(seat.id) ? 'white' : '#475569')
                                     }">
                      <!-- Headrest detail -->
                      <div *ngIf="!seat.isReserved && !isSelected(seat.id)"
                        style="position: absolute; top: -4px; width: 30px; height: 4px; background: #cbd5e1; border-radius: 4px 4px 0 0;">
                      </div>
                      {{ col }}
                    </div>
                  </ng-container>
                  <ng-template #noSeat>
                    <div style="width: 44px;"></div>
                  </ng-template>
                </div>
              </ng-container>

              <!-- AISLE with row number -->
              <div class="aisle" style="text-align: center; color: #cbd5e1; font-size: 0.9rem; font-weight: bold;">{{
                row }}</div>

              <!-- RIGHT SEATS -->
              <ng-container *ngFor="let col of ['D','E','F']">
                <div style="display: flex; justify-content: center;">
                  <ng-container *ngIf="getSeat(row, col) as seat; else noSeat">
                    <div class="seat" [class.reserved]="seat.isReserved" [class.selected]="isSelected(seat.id)"
                      (click)="selectSeat(seat)"
                      style="width: 44px; height: 44px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.2s; border-bottom: 4px solid rgba(0,0,0,0.1); position: relative;"
                      [ngStyle]="{
                                         'background': seat.isReserved ? '#ef4444' : (isSelected(seat.id) ? '#22c55e' : (seat.class === 'Business' ? '#eab308' : '#fff')),
                                         'border': seat.isReserved ? 'none' : (isSelected(seat.id) ? 'none' : '2px solid #94a3b8'),
                                         'color': seat.isReserved ? 'white' : (isSelected(seat.id) ? 'white' : '#475569')
                                      }">
                      <!-- Headrest detail -->
                      <div *ngIf="!seat.isReserved && !isSelected(seat.id)"
                        style="position: absolute; top: -4px; width: 30px; height: 4px; background: #cbd5e1; border-radius: 4px 4px 0 0;">
                      </div>
                      {{ col }}
                    </div>
                  </ng-container>
                  <ng-template #noSeat>
                    <div style="width: 44px;"></div>
                  </ng-template>
                </div>
              </ng-container>

              <!-- Right Window -->
              <div
                style="width: 8px; height: 28px; background: #e0f2fe; border: 2px solid #cbd5e1; border-radius: 10px; margin: 0 auto;">
              </div>

            </div>
          </div>

          <!-- REAR SERVICE AREA (Blue Zone) -->
          <div class="service-area-rear"
            style="background: #0ea5e9; height: 80px; display: flex; align-items: center; justify-content: center; position: relative;">
            <div style="font-size: 2rem; color: rgba(255,255,255,0.8);">âœˆ</div>
          </div>


          <!-- LEFT WING -->
          <div style="position: absolute; top: 320px; left: -220px; width: 230px; height: 350px; 
                        background: radial-gradient(circle at 100% 0%, #e2e8f0, #cbd5e1);
                        clip-path: polygon(100% 20%, 10% 90%, 0 100%, 100% 60%);
                        z-index: 1; opacity: 0.9;">
            <div
              style="position: absolute; bottom: 40%; left: 40%; width: 30px; height: 80px; background: #cccccc; border-radius: 15px; transform: rotate(-35deg); box-shadow: 2px 2px 10px rgba(0,0,0,0.2);">
            </div>
          </div>

          <!-- RIGHT WING -->
          <div style="position: absolute; top: 320px; right: -220px; width: 230px; height: 350px; 
                        background: radial-gradient(circle at 0% 0%, #e2e8f0, #cbd5e1);
                        clip-path: polygon(0 20%, 90% 90%, 100% 100%, 0 60%);
                        z-index: 1; opacity: 0.9;">
            <div
              style="position: absolute; bottom: 40%; right: 40%; width: 30px; height: 80px; background: #cccccc; border-radius: 15px; transform: rotate(35deg); box-shadow: -2px 2px 10px rgba(0,0,0,0.2);">
            </div>
          </div>

          <!-- TAIL SECTION -->
          <div style="position: absolute; bottom: -60px; left: 50%; transform: translateX(-50%); width: 300px; height: 120px; 
                       background: #cbd5e1; clip-path: polygon(20% 0, 80% 0, 100% 100%, 0% 100%); z-index: 0;">
            <div
              style="width: 100%; height: 100%; background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.1));">
            </div>
          </div>

        </div>

      </div>

      <!-- PAYMENT SECTION -->
      <div class="payment-section"
        style="background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; max-width: 600px; margin: 0 auto;">
        <h3 class="section-title" style="display: flex; align-items: center; gap: 10px; margin-top: 0;">
          <span
            style="background: #10b981; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem;">$</span>
          Payment Details
        </h3>

        <div class="form-row">
          <label style="color: #64748b; font-weight: 500;">Card Number</label>
          <div style="position: relative;">
            <input type="number" formControlName="cardNumber" placeholder="0000 0000 0000" maxlength="12"
              style="width: 100%; padding: 12px 15px; padding-left: 45px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: all 0.2s;">
            <div style="position: absolute; left: 15px; top: 12px; font-size: 1.2rem; opacity: 0.5;">ðŸ’³</div>
          </div>
        </div>

        <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
          <div class="form-row">
            <label style="color: #64748b; font-weight: 500;">Expiry Date</label>
            <input type="month" formControlName="expiryDate"
              style="width: 100%; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 1rem;">
          </div>
          <div class="form-row">
            <label style="color: #64748b; font-weight: 500;">CVV</label>
            <input type="text" formControlName="cvv" placeholder="123" maxlength="3"
              style="width: 100%; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 1rem;">
          </div>
        </div>

        <!-- SUMMARY & BUTTON -->
        <div
          style="margin-top: 30px; padding-top: 20px; border-top: 2px dashed #e2e8f0; display: flex; align-items: center; justify-content: space-between;">
          <div style="font-size: 1.5rem; font-weight: 800; color: #1e293b;">
            <span style="font-size: 0.9rem; color: #64748b; font-weight: normal; margin-right: 5px;">Total</span>${{
            getPrice() }}
          </div>
          <button type="submit" [disabled]="bookingForm.invalid || loading"
            style="background: #000; color: white; padding: 12px 30px; border-radius: 10px; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.2s;">
            {{ loading ? 'Processing...' : 'Pay Now' }}
          </button>
        </div>


        <div *ngIf="errorMessage" class="error-msg">
          {{ errorMessage }}
        </div>
        {{ successMessage }}
      </div>
    </form>
  </div>
</div>
```